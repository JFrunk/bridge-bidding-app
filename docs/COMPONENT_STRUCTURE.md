# Component Structure & Architecture

## Visual Directory Structure

```
frontend/src/
â”œâ”€â”€ ğŸ“ components/
â”‚   â”œâ”€â”€ ğŸ“ ui/                          # ğŸ¨ SHADCN BASE COMPONENTS (Don't modify)
â”‚   â”‚   â”œâ”€â”€ button.jsx                  #    Generated by Shadcn CLI
â”‚   â”‚   â”œâ”€â”€ card.jsx                    #    Standard UI primitives
â”‚   â”‚   â”œâ”€â”€ dialog.jsx                  #    Accessible, unstyled base
â”‚   â”‚   â”œâ”€â”€ select.jsx                  #    Built on Radix UI
â”‚   â”‚   â”œâ”€â”€ textarea.jsx                #    Keyboard-friendly
â”‚   â”‚   â””â”€â”€ ...                         #    Add more as needed
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“ bridge/                      # ğŸƒ BRIDGE-SPECIFIC COMPONENTS
â”‚   â”‚   â”œâ”€â”€ bridge-card.jsx             #    Playing card (Aâ™ , Kâ™¥, etc.)
â”‚   â”‚   â”œâ”€â”€ bidding-box.jsx             #    Bidding interface (1â™£, Pass, X)
â”‚   â”‚   â”œâ”€â”€ bidding-table.jsx           #    Auction history table
â”‚   â”‚   â”œâ”€â”€ hand-analysis.jsx           #    HCP, distribution display
â”‚   â”‚   â”œâ”€â”€ review-modal.jsx            #    AI review request dialog
â”‚   â”‚   â”œâ”€â”€ convention-help-modal.jsx   #    Convention info display
â”‚   â”‚   â””â”€â”€ __tests__/                  #    Tests for each component
â”‚   â”‚
â”‚   â””â”€â”€ ğŸ“ play/                        # ğŸ® PLAY PHASE COMPONENTS
â”‚       â”œâ”€â”€ play-table.jsx              #    Main play area (compass layout)
â”‚       â”œâ”€â”€ contract-header.jsx         #    Contract, tricks, bidding summary
â”‚       â”œâ”€â”€ trick-display.jsx           #    Current trick in center
â”‚       â”œâ”€â”€ user-hand.jsx               #    South (user) hand
â”‚       â”œâ”€â”€ dummy-hand.jsx              #    Revealed dummy hand
â”‚       â”œâ”€â”€ turn-indicator.jsx          #    Whose turn indicator
â”‚       â”œâ”€â”€ contract-goal-tracker.jsx   #    Tricks won/needed progress
â”‚       â”œâ”€â”€ score-modal.jsx             #    End-of-hand scoring
â”‚       â””â”€â”€ __tests__/                  #    Tests for each component
â”‚
â”œâ”€â”€ ğŸ“ stores/                          # ğŸ—„ï¸ ZUSTAND STATE STORES
â”‚   â”œâ”€â”€ biddingStore.js                 #    Bidding phase state
â”‚   â”œâ”€â”€ playStore.js                    #    Play phase state
â”‚   â””â”€â”€ uiStore.js                      #    UI state (modals, errors)
â”‚
â”œâ”€â”€ ğŸ“ lib/                             # ğŸ› ï¸ UTILITIES
â”‚   â””â”€â”€ utils.js                        #    cn() helper, formatters
â”‚
â”œâ”€â”€ ğŸ“ shared/                          # âš ï¸ LEGACY (To be migrated)
â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”œâ”€â”€ Card.js                     #    OLD: Migrate to bridge/bridge-card.jsx
â”‚   â”‚   â”œâ”€â”€ HandAnalysis.js             #    OLD: Migrate to bridge/hand-analysis.jsx
â”‚   â”‚   â””â”€â”€ PlayerHand.js               #    OLD: Migrate to play/user-hand.jsx
â”‚   â””â”€â”€ services/
â”‚       â””â”€â”€ SessionService.js           #    Keep (not UI-related)
â”‚
â”œâ”€â”€ App.js                              # ğŸ  MAIN APP COMPONENT
â”œâ”€â”€ App.css                             # âš ï¸ TO BE REMOVED (migrate to Tailwind)
â”œâ”€â”€ index.js                            # Entry point
â”œâ”€â”€ index.css                           # Global styles + Tailwind imports
â”œâ”€â”€ PlayComponents.js                   # âš ï¸ TO BE REMOVED (migrate to play/ folder)
â””â”€â”€ PlayComponents.css                  # âš ï¸ TO BE REMOVED (migrate to Tailwind)
```

---

## Component Dependency Graph

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          App.js                             â”‚
â”‚  Main application component                                 â”‚
â”‚  Orchestrates bidding and play phases                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚            â”‚             â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ Bidding Phase  â”‚  â”‚ Play Phaseâ”‚  â”‚ Common UI   â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                â”‚                 â”‚                â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚           â”‚         â”‚       â”‚       â”‚        â”‚        â”‚
â”Œâ”€â”€â”€â–¼â”€â”€â”€â”  â”Œâ”€â”€â”€â–¼â”€â”€â”€â”  â”Œâ”€â”€â–¼â”€â”€â” â”Œâ”€â”€â–¼â”€â”€â” â”Œâ”€â”€â–¼â”€â”€â”€â” â”Œâ”€â–¼â”€â”€â”  â”Œâ”€â”€â–¼â”€â”€â”€â”
â”‚Biddingâ”‚  â”‚Biddingâ”‚  â”‚Hand â”‚ â”‚Play â”‚ â”‚User  â”‚ â”‚Dummyâ”‚ â”‚Reviewâ”‚
â”‚ Box   â”‚  â”‚ Table â”‚  â”‚Analyâ”‚ â”‚Tableâ”‚ â”‚ Hand â”‚ â”‚Hand â”‚ â”‚Modal â”‚
â””â”€â”€â”€â”¬â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”¬â”€â”€â”˜ â””â”€â”€â”¬â”€â”€â”˜ â””â”€â”€â”¬â”€â”€â”€â”˜ â””â”€â”€â”¬â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”˜
    â”‚                     â”‚       â”‚       â”‚        â”‚
    â”‚                     â”‚       â”‚       â”‚        â”‚
â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚             ğŸƒ BridgeCard Component                          â”‚
â”‚  Base component used everywhere cards are displayed         â”‚
â”‚  (bidding hand, play hand, dummy, trick display)            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â”‚
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚  Shadcn Card (base)   â”‚
                â”‚  + Tailwind CSS       â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## State Management Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     React Component Tree                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚               â”‚               â”‚
â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
â”‚ Bidding     â”‚  â”‚   Play   â”‚  â”‚     UI     â”‚
â”‚ Components  â”‚  â”‚Componentsâ”‚  â”‚ Components â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚              â”‚              â”‚
       â”‚ useStore()   â”‚ useStore()   â”‚ useStore()
       â”‚              â”‚              â”‚
â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
â”‚ Bidding     â”‚  â”‚   Play   â”‚  â”‚     UI     â”‚
â”‚   Store     â”‚  â”‚  Store   â”‚  â”‚   Store    â”‚
â”‚ (Zustand)   â”‚  â”‚(Zustand) â”‚  â”‚ (Zustand)  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚              â”‚              â”‚
       â”‚              â”‚              â”‚
â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
â”‚       Derived State & Selectors           â”‚
â”‚  Computed values, memoized calculations   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Bidding Store State
```javascript
{
  hand: [],                  // User's cards
  handPoints: {...},         // HCP, distribution
  auction: [],               // Bid history
  nextPlayerIndex: 0,        // Whose turn
  isAiBidding: false,        // AI turn in progress
  vulnerability: 'None',     // Vuln status
  allHands: null,            // All 4 hands (debug)
  showHandsThisDeal: false,  // Show all hands
  alwaysShowHands: false,    // Always show mode
  selectedScenario: '',      // Scenario name
  scenarioList: [],          // Available scenarios
  initialDeal: null,         // Starting state (for replay)
}
```

### Play Store State
```javascript
{
  gamePhase: 'bidding',      // 'bidding' | 'playing'
  playState: {...},          // Current play state from backend
  dummyHand: [],             // Dummy's cards
  declarerHand: [],          // Declarer's cards (if user is dummy)
  isPlayingCard: false,      // Card play in progress
  scoreData: null,           // Final score (end of hand)
}
```

### UI Store State
```javascript
{
  error: '',                 // Error message to display
  displayedMessage: '',      // Feedback message
  showReviewModal: false,    // AI review modal state
  showConventionHelp: false, // Convention help modal
  conventionInfo: null,      // Convention data
  reviewPrompt: '',          // Generated review prompt
}
```

---

## Component Relationships

### BridgeCard
**Used by**: BiddingBox, UserHand, DummyHand, TrickDisplay, HandAnalysis

**Props**:
```jsx
<BridgeCard
  rank="A"                 // 'A', 'K', 'Q', 'J', 'T', '9', etc.
  suit="â™ "                 // 'â™ ', 'â™¥', 'â™¦', 'â™£'
  onClick={handleClick}    // Optional click handler
  disabled={false}         // Disable interaction
  className=""             // Additional Tailwind classes
/>
```

### BiddingBox
**Used by**: App.js (during bidding phase)

**Props**:
```jsx
<BiddingBox
  onBid={handleUserBid}    // Callback: (bid: string) => void
  disabled={!userTurn}     // Disable all buttons
  auction={[...]}          // Bid history for legal bid validation
/>
```

### PlayTable
**Used by**: App.js (during play phase)

**Props**:
```jsx
<PlayTable
  playState={state}              // Current play state
  userHand={[...]}               // South's cards
  dummyHand={[...]}              // Dummy's cards
  declarerHand={[...]}           // Declarer's cards (if user is dummy)
  onCardPlay={handleCardPlay}    // User card click
  onDummyCardPlay={handleDummy}  // Dummy card click (user controls)
  onDeclarerCardPlay={handleDec} // Declarer card click (user is dummy)
  isUserTurn={true}              // Is it user's turn?
  isDummyTurn={false}            // Is it dummy's turn (user controls)?
  isDeclarerTurn={false}         // Is it declarer's turn (user is dummy)?
  auction={[...]}                // Bid history
/>
```

---

## Styling Patterns

### Pattern 1: Card Component (Shadcn Base + Tailwind)
```jsx
import { Card } from "@/components/ui/card";
import { cn } from "@/lib/utils";

export function BridgeCard({ rank, suit, className }) {
  return (
    <Card className={cn(
      "w-[70px] h-[100px]",    // Size
      "bg-white",               // Background
      "border border-gray-400", // Border
      "rounded-card",           // Border radius (custom: 6px)
      "shadow-md",              // Shadow
      className                 // Allow overrides
    )}>
      {/* Content */}
    </Card>
  );
}
```

### Pattern 2: Layout with Responsive Spacing
```jsx
<div className={cn(
  "flex flex-col",      // Vertical stack
  "gap-4 md:gap-6",     // Mobile: 1rem, Desktop: 1.5rem
  "p-4 md:p-6",         // Mobile: 1rem padding, Desktop: 1.5rem
  "bg-bg-secondary",    // Custom background color
  "rounded-lg"          // Large border radius (12px)
)}>
  {/* Content */}
</div>
```

### Pattern 3: Conditional Styling
```jsx
<Button className={cn(
  "base-classes",                          // Always applied
  isActive && "bg-success text-white",     // Active state
  isDisabled && "opacity-60 cursor-not-allowed", // Disabled
  variant === 'primary' && "font-bold",    // Variant
)}>
  {label}
</Button>
```

### Pattern 4: Suit Colors
```jsx
const getSuitColor = (suit) => {
  return (suit === 'â™¥' || suit === 'â™¦') ? 'text-suit-red' : 'text-suit-black';
};

<span className={cn("text-2xl", getSuitColor(suit))}>
  {suit}
</span>
```

---

## Migration Checklist by Component

### âœ… Ready to Migrate (Clear Path)
- [x] Card â†’ BridgeCard (in REFACTORING_PLAN)
- [x] BiddingBox (in REFACTORING_PLAN)
- [x] ReviewModal (in REFACTORING_PLAN)
- [x] ConventionHelpModal (in REFACTORING_PLAN)

### ğŸŸ¡ Medium Complexity (Needs Breakdown)
- [ ] BiddingTable â†’ Use Shadcn Table component
- [ ] HandAnalysis â†’ Simple info display, straightforward
- [ ] ScoreDisplay â†’ Shadcn Dialog with table

### ğŸ”´ High Complexity (Careful Planning)
- [ ] PlayTable â†’ Break into subcomponents first
  - [ ] ContractHeader (done in REFACTORING_PLAN)
  - [ ] TrickDisplay (compass layout)
  - [ ] PlayerPositions (N/E/S/W arrangement)
- [ ] AI Play Loop â†’ State management, careful testing
- [ ] Card Play Logic â†’ Must preserve exact behavior

---

## Testing Strategy

### Unit Tests (Component Level)
```javascript
// Example: BridgeCard.test.jsx
describe('BridgeCard', () => {
  it('renders rank and suit');
  it('applies correct suit color');
  it('handles click when not disabled');
  it('does not handle click when disabled');
  it('has correct aria-label');
  it('applies custom className');
});
```

### Integration Tests (Feature Level)
```javascript
// Example: bidding-flow.test.jsx
describe('Bidding Flow', () => {
  it('allows user to bid on their turn');
  it('prevents user from bidding on AI turn');
  it('validates legal bids only');
  it('transitions to play after auction ends');
});
```

### E2E Tests (Full Game)
```javascript
// Example: full-game.test.jsx
describe('Full Game Flow', () => {
  it('completes bidding phase');
  it('starts play phase with correct contract');
  it('allows card play for declarer and dummy');
  it('calculates score correctly at end');
});
```

---

## Performance Considerations

### Lazy Loading
```jsx
import { lazy, Suspense } from 'react';

const PlayTable = lazy(() => import('@/components/play/play-table'));

// In component:
<Suspense fallback={<div>Loading...</div>}>
  <PlayTable {...props} />
</Suspense>
```

### Memoization
```jsx
import { memo, useMemo } from 'react';

export const BridgeCard = memo(({ rank, suit, onClick }) => {
  const suitColor = useMemo(() =>
    getSuitColor(suit),
    [suit]
  );

  return (/* ... */);
});
```

### Virtual Scrolling (if needed for long lists)
```jsx
// For auction history with 100+ bids
import { useVirtualizer } from '@tanstack/react-virtual';
```

---

## Accessibility Standards

### Keyboard Navigation
- All interactive elements must be keyboard accessible
- Focus visible: `focus:ring-2 focus:ring-info`
- Tab order logical (top to bottom, left to right)

### Screen Reader Support
- aria-label on all buttons: `aria-label="Bid 1 Spade"`
- aria-live regions for dynamic updates: `aria-live="polite"`
- Role attributes: `role="button"`, `role="region"`

### Color Contrast
- Must meet WCAG AA (4.5:1 for normal text, 3:1 for large text)
- Test with axe DevTools
- Don't rely on color alone (use icons/text too)

---

## Deployment Checklist

### Before Merge
- [ ] All tests pass (`npm test`)
- [ ] Build succeeds (`npm run build`)
- [ ] Bundle size check (`npx source-map-explorer`)
- [ ] Lighthouse audit (>90 all categories)
- [ ] Manual testing (bidding + play flow)
- [ ] Mobile responsive check (320px, 768px, 1024px)
- [ ] Accessibility audit (axe DevTools, keyboard nav)
- [ ] Code review (follow Rule of Three?)

### After Merge
- [ ] Monitor production for errors
- [ ] Check performance metrics
- [ ] User feedback
- [ ] Rollback plan ready

---

**Last Updated**: 2025-10-13
**Version**: 1.0
**Related Documents**:
- [UI_UX_FRAMEWORK.md](./UI_UX_FRAMEWORK.md) - Strategic framework
- [REFACTORING_PLAN.md](./REFACTORING_PLAN.md) - Implementation steps
- [LLM_PROMPTING_GUIDE.md](./LLM_PROMPTING_GUIDE.md) - Prompt templates
